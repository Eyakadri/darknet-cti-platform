@startuml
' Data Flow / Sequence (Raw Post to Indexed Doc)
skinparam backgroundColor #0d1117
skinparam sequenceArrowThickness 2
skinparam sequenceParticipantBackgroundColor #161b22
skinparam sequenceParticipantBorderColor #30363d
skinparam sequenceLifeLineBorderColor #58a6ff
skinparam sequenceLifeLineBackgroundColor #0d1117
skinparam ArrowColor #58a6ff
skinparam ParticipantFontColor #c9d1d9
skinparam SequenceMessageFontColor #c9d1d9

actor Operator
participant Spider as "Scrapy Spider"
participant FS as "Raw FS\n(data/raw)"
participant Proc as "DataProcessor"
participant NLP as "CTINLPProcessor"
participant ES as "Elasticsearch"
participant Dash as "Kibana/Grafana"

Operator -> Spider: Start crawl
Spider -> Sources: Fetch forum pages
Sources --> Spider: HTML responses
Spider -> Spider: Parse threads & posts
Spider -> FS: Write post_{hash}.json
== Batch Processing ==
Operator -> Proc: Run processor batch
Proc -> FS: Scan *.json
loop For each file
  Proc -> Proc: Validate / length filter
  Proc -> NLP: Extract entities / IOCs
  NLP --> Proc: Threat summary
  Proc -> ES: Index (id=content_hash)
  ES --> Proc: Ack / failure
  Proc -> FS: Move file to processed/
end
== Analytics ==
Dash -> ES: Query dashboards
ES --> Dash: Aggregations / Documents
@enduml